<head>
  <meta charset="utf-8">
  <meta name="description" content="the Local Weather by Yingjie Hu">
  <meta name="author" content="Yingjie Hu">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>the Local Weather</title>

  <script defer src="https://use.fontawesome.com/releases/v5.0.1/js/all.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="css/main.css">
  <script src="scripts/main.js"></script>
  <script>
  $(document).ready(function(){
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
        var weatherAPI = "https://fcc-weather-api.glitch.me/api/current?lat=" + latitude + "&lon=" + longitude;
        var googleAPI = "https://maps.googleapis.com/maps/api/geocode/json?&latlng=" + latitude + "," + longitude;
        //console.log("latitude: "+position.coords.latitude);
        console.log(weatherAPI);
        console.log(googleAPI);
        $.getJSON(weatherAPI, function(json){
          var windSpeed = json["wind"]["speed"];
          var windDegree = json["wind"]["deg"];
          var windDirection;
          if (windDegree >0 && windDegree <=90) windDirection = "NE";
          else if (windDegree > 90 && windDegree <= 180) windDirection = "SE";
          else if (windDegree > 180 && windDegree <= 270) windDirection = "SW";
          else windDirection = "NW";

          var temperature = json["main"]["temp"]
          var c = Math.round(temperature);
          var f = Math.round(temperature*9/5+32);

          //$("#weatherIcon").html("<img src=" + json["weather"][0]["icon"] + ">");
          $("#temperature").html(f);
          $("#weatherDescription").html(json["weather"][0]["description"].toUpperCase());
          $("#wind").html(windDirection + " "+ windSpeed + " knots");

          //console.log(json["weather"][0]["main"]);
          //console.log(json["wind"]["deg"]);

          switch(json["weather"][0]["main"].toLowerCase()){
            case "mist": $("body").css("background-image", url("img/mist.jpg")); break;
            case "snow": $("body").css("background-image", url("img/snow.jpg")); break;

          };

        })

        $.getJSON(googleAPI, function(json){
          //console.log(json.results[0]["address_components"]);
          var addressInfo = json.results[0]["address_components"];
          //var city;
          var area;
          var country;
          //var postalCode;
          for( var i = 0; i < addressInfo.length; i++){
            switch(addressInfo[i]["types"][0]){
              //case "locality": city = addressInfo[i]["long_name"]; break;
              case "administrative_area_level_1": area = addressInfo[i]["long_name"]; break;
              case "country": country = addressInfo[i]["short_name"]; break;
              //case "postal_code": postalCode = addressInfo[i]["long_name"]; break;
            }
          }
          //console.log("city: "+city+" area: "+area+" country: "+country+" postal code: "+postalCode);
          $("#location").html(area + ", " + country);
        })
      });
    }
  });
</script>

</head>


<body>
  <div class="container text-center">
    <div class="title"> Free Code Camp Zipline</div>

    <div class="subtitle">Local Weather App - <span id="location"></span></div>

    <div class="temperature">
      <span id="weatherIcon" style="color:white"><i class="fas fa-cloud" style="padding-right: 8px"></i></span><span id="temperature"></span> Â°F
    </div>

    <div class="row justify-content-center">
      <div class="weather col-md-auto">Alameda, California</div>
      <div class="weather col-md-auto" id="weatherDescription">sky is clear</div>
      <div class="weather col-md-auto" id="wind"></div>
    </div>

  </div>

  <div id="footer" class="container justify-content-center text-center">
    Written and Coded By <a href="http://yingjiehu.com" target="_blank">Yingjie Hu</a> with <span style="color:red"><i class="fas fa-heart"></i></span><br>
    View <a href="https://github.com/huyingjie/theLocalWeather" target="_blank">source code</a> at GitHub and latest <a href="http://localweather.yingjiehu.com/" target="_blank">updated website</a>
  </div>
</body>
